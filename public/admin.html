<!doctype html>
<html lang="tr">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Admin</title><link rel="stylesheet" href="/styles.css"></head>
<body>
  <div class="container">
    <h2>Admin Paneli</h2>
    <div class="card" style="padding:16px">
      <form id="saveForm">
        <label class="small">Sipariş ID:</label>
        <input name="id" class="input" required style="border:1px solid rgba(255,255,255,.18);border-radius:10px;background:rgba(255,255,255,.04);padding:10px" />
        <div class="small" style="margin-top:12px">Adımlar (her satır: <code>adım - çentik</code>)</div>
        <textarea name="steps" rows="10" style="width:100%;margin-top:6px;border:1px solid rgba(255,255,255,.18);border-radius:10px;background:rgba(255,255,255,.04);color:#fff;padding:10px" placeholder="1 - 93
2 - 201
3 - 9"></textarea>
        <div class="controls">
          <button type="submit" class="btn">Kaydet</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    document.getElementById('saveForm').addEventListener('submit', async e => {
      e.preventDefault();
      const id = e.target.id.value.trim();
      const raw = e.target.steps.value.trim().split(/\n/);
      const steps = raw.filter(Boolean).map(line => {
        const m = line.match(/^(\d+)\s*-\s*(\d+)$/);
        if(!m) return null;
        return { step: parseInt(m[1],10), notch: parseInt(m[2],10) };
      }).filter(Boolean);
      const res = await fetch('/api/admin/save', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ id, steps })});
      const out = await res.json();
      if(res.ok) alert('Kaydedildi ('+out.total+' adım)'); else alert(out.error||'Hata');
    });
  </script>
</body>
</html>
